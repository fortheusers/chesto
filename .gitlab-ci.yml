image: ubuntu:18.04

variables:
  GIT_SUBMODULE_STRATEGY: recursive

pages:
  stage: deploy
  script:
    - apt-get update && apt-get -y install doxygen
    - doxygen
    - mkdir -p public
    - cp -r docs/html/* public
  artifacts:
    paths:
      - public

.common: &common
  script:
    - apt-get update && apt-get -y install git
    - git clone https://gitlab.com/4TU/chestotesto.git /chestotesto
    - /chestotesto/dependency_helper.sh
    - cp -rf . /chestotesto/libs/chesto
    - (cd /chestotesto && make -f Makefile.$PLATFORM)
    - cp /chestotesto/chestotesto.$EXT chestotesto.$EXT
  artifacts:
    paths:
      - chestotesto.$EXT

PC:
  <<: *common
  variables:
    PLATFORM: pc
    EXT: bin

PC-sdl1:
  <<: *common
  variables:
    PLATFORM: pc-sdl1
    EXT: bin

WiiU:
  <<: *common
  variables:
    PLATFORM: wiiu
    EXT: rpx

Switch:
  <<: *common
  variables:
    PLATFORM: switch
    EXT: nro

3ds:
  <<: *common
  variables:
    PLATFORM: 3ds
    EXT: 3dsx

Wii:
  <<: *common
  variables:
    PLATFORM: wii
    EXT: dol
